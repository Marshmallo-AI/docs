---
sidebar_position: 1
---

# Python

This documentation provides a brief overview of how to use the Python SDK.

## Install
```bash
pip install marlo
```

## Initialize
Initialize once at startup with your API key.

```python
import os
import marlo

marlo.init(api_key=os.getenv("MARLO_API_KEY") or "YOUR_API_KEY")
```

## Register an Agent
Register each agent type once per process. This stores the definition for the dashboard and reward pipeline.

```python
marlo.agent(
    name="weather-assistant",
    system_prompt="You are a helpful weather assistant.",
    tools=[
        {
            "name": "get_weather",
            "description": "Get current weather for a location",
            "parameters": {
                "type": "object",
                "properties": {"location": {"type": "string"}},
                "required": ["location"],
            },
        }
    ],
    mcp=[],
)
```

## Track a Task
Wrap each execution with `marlo.task`. Use a stable `thread_id` per conversation. `thread_name` is optional, shown in the dashboard, and stays fixed once set for a thread.

```python
with marlo.task(
    thread_id="conversation-123",
    thread_name="Weather Query",
    agent="weather-assistant",
) as task:
    task.input("What is the weather in Tokyo?")
    task.tool(name="get_weather", input={"location": "Tokyo"}, output="25C, sunny")
    task.reasoning("Found current conditions. Preparing response.")
    task.llm(model="gpt-4", usage={"input_tokens": 150, "output_tokens": 50})
    task.output("Tokyo is 25C and sunny.")
```

## Tool Calls
Use `task.tool` for each tool execution.

```python
task.tool(
    name="search",
    input={"query": "weather Tokyo"},
    output="25C, sunny",
)
```

## LLM Calls
Use `task.llm` for each model call. Include `usage` when available for billing and metrics.

```python
task.llm(
    messages=[{"role": "user", "content": "What is the weather?"}],
    model="gpt-4",
    response={"text": "It is sunny."},
    usage={"input_tokens": 150, "output_tokens": 50},
)
```

## Error Handling
If your code raises an exception inside the context, the task is marked as error automatically. You can also mark errors explicitly.

```python
task.error("Tool returned invalid response")
```

## Multi-Agent Tasks
Use `task.child()` to capture child runs and link them to the parent.

```python
with marlo.task(thread_id="abc", thread_name="Research", agent="orchestrator") as parent:
    parent.input("Summarize topic X")
    with parent.child(agent="researcher") as child:
        child.input("Find sources for topic X")
        child.tool(name="search", input={"query": "topic X"}, output="...")
        child.output("Findings...")
    parent.output("Summary...")
```

## Full Example
```python
import os
import marlo

marlo.init(api_key=os.getenv("MARLO_API_KEY") or "YOUR_API_KEY")

marlo.agent(
    name="support-agent",
    system_prompt="You are a support agent.",
    tools=[{"name": "lookup_order", "description": "Find order by ID", "parameters": {}}],
    mcp=[],
)


def run_agent(user_input: str, thread_id: str) -> str:
    with marlo.task(thread_id=thread_id, agent="support-agent") as task:
        task.input(user_input)
        task.llm(model="gpt-4", usage={"input_tokens": 120, "output_tokens": 40})
        response = "Here is your order status."
        task.output(response)
        return response
```
