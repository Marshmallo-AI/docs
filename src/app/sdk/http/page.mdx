---
sidebar_position: 3
---

# HTTP API

Use the HTTP API if you do not want to use an SDK or are working in a non-Python runtime.

## Endpoints
- `POST {endpoint}/events`
- `POST {endpoint}/learnings`

All requests require:
```
Authorization: Bearer <write_key>
Content-Type: application/json
```

## Event Shape
Each event is a JSON object with the same top-level shape:

```json
{
  "run_id": 1720000000000,
  "agent_id": "support-agent",
  "parent_agent_id": null,
  "invocation_id": "uuid-123",
  "task_id": 1720000000000000,
  "event_type": "llm_call",
  "payload": {}
}
```

## Required Events
To receive rewards and learnings, send:
- `agent_definition`
- `task_start`
- `llm_call`
- `tool_call`
- `task_end`

### agent_definition payload
```json
{
  "agent_id": "support-agent",
  "parent_agent_id": null,
  "name": "support-agent",
  "system_prompt": "You are a support agent",
  "tool_definitions": [],
  "mcp_definitions": [],
  "model_config": { "model": "gpt-4" },
  "definition_hash": "sha256-hash"
}
```

### task_start payload
```json
{
  "task_id": 1720000000000000,
  "task": "reset my password",
  "metadata": { "thread_id": "conversation-123", "thread_name": "Password Reset" }
}
```

### llm_call payload
```json
{
  "messages": [{ "role": "user", "content": "reset my password" }],
  "model_params": { "model": "gpt-4" },
  "response": { "text": "Sure, I can help" },
  "usage": { "prompt_tokens": 12, "completion_tokens": 18, "total_tokens": 30 },
  "reasoning": { "summary": "Provide reset steps" }
}
```

### tool_call payload
```json
{
  "tool_name": "get_user_info",
  "input": { "user_id": "u_123" },
  "output": { "email": "user@example.com" }
}
```

### task_end payload
```json
{
  "task_id": 1720000000000000,
  "status": "success",
  "final_answer": "Reset link sent."
}
```

## Send Events
Send a batch of events in one request:

```bash
curl -X POST "$MARLO_ENDPOINT/events" \
  -H "Authorization: Bearer $MARLO_WRITE_KEY" \
  -H "Content-Type: application/json" \
  -d '[
    {
      "run_id": 1720000000000,
      "agent_id": "support-agent",
      "parent_agent_id": null,
      "invocation_id": "uuid-123",
      "task_id": 1720000000000000,
      "event_type": "task_start",
      "payload": { "task_id": 1720000000000000, "task": "reset my password" }
    }
  ]'
```

## Fetch Learnings
```bash
curl -X POST "$MARLO_ENDPOINT/learnings" \
  -H "Authorization: Bearer $MARLO_WRITE_KEY" \
  -H "Content-Type: application/json" \
  -d '{"learning_key":"support-agent"}'
```

The response returns:
```json
{
  "learning_state": {
    "learnings_text": "..."
  }
}
```
