"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[643],{8453(e,n,t){t.d(n,{R:()=>a,x:()=>r});var s=t(6540);const o={},i=s.createContext(o);function a(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),s.createElement(i.Provider,{value:n},e.children)}},8555(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>p,frontMatter:()=>a,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"sdk/python","title":"Python","description":"This page is the full, end\u2011to\u2011end Python integration. If your agent runs in Python, this is the only page you need.","source":"@site/docs/sdk/python.md","sourceDirName":"sdk","slug":"/sdk/python","permalink":"/sdk/python","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/sdk/python.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Introduction","permalink":"/"},"next":{"title":"TypeScript","permalink":"/sdk/typescript"}}');var o=t(4848),i=t(8453);const a={sidebar_position:1},r="Python",l={},d=[{value:"Install",id:"install",level:2},{value:"What You Must Provide",id:"what-you-must-provide",level:2},{value:"Step 1: Find The Right Wrap Point",id:"step-1-find-the-right-wrap-point",level:2},{value:"Step 2: Define Tool Definitions",id:"step-2-define-tool-definitions",level:2},{value:"Step 3: Initialize Marlo",id:"step-3-initialize-marlo",level:2},{value:"Step 4: Wrap The Agent Entrypoint",id:"step-4-wrap-the-agent-entrypoint",level:2},{value:"Step 5: Capture Tool Calls (Required)",id:"step-5-capture-tool-calls-required",level:2},{value:"Step 6: Capture LLM Calls (Required)",id:"step-6-capture-llm-calls-required",level:2},{value:"Step 7: Use Learnings In The Next Run",id:"step-7-use-learnings-in-the-next-run",level:2},{value:"Agent Systems",id:"agent-systems",level:2},{value:"Full Example: Single Agent (Auth0 Assistant)",id:"full-example-single-agent-auth0-assistant",level:2},{value:"Multi\u2011Agent Example",id:"multiagent-example",level:2},{value:"Checklist",id:"checklist",level:2}];function c(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"python",children:"Python"})}),"\n",(0,o.jsx)(n.p,{children:"This page is the full, end\u2011to\u2011end Python integration. If your agent runs in Python, this is the only page you need."}),"\n",(0,o.jsx)(n.h2,{id:"install",children:"Install"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"pip install marlo\n"})}),"\n",(0,o.jsx)(n.h2,{id:"what-you-must-provide",children:"What You Must Provide"}),"\n",(0,o.jsx)(n.p,{children:"You need these inputs before you start:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Organization ID:"})," the ID from the dashboard that identifies your organization in Marlo."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Write key:"})," the API key used to send events to Marlo."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Endpoint:"})," the Marlo API base URL."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Agent definition:"})," system prompt, tool definitions, MCP definitions, and model configuration."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"step-1-find-the-right-wrap-point",children:"Step 1: Find The Right Wrap Point"}),"\n",(0,o.jsxs)(n.p,{children:["Wrap the function that ",(0,o.jsx)(n.strong,{children:"actually calls"})," the agent (the place where you do ",(0,o.jsx)(n.code,{children:"invoke"})," or ",(0,o.jsx)(n.code,{children:"ainvoke"}),")."]}),"\n",(0,o.jsx)(n.p,{children:"If you only wrap an HTTP proxy or a router, you will capture nothing because the agent does not run there."}),"\n",(0,o.jsx)(n.h2,{id:"step-2-define-tool-definitions",children:"Step 2: Define Tool Definitions"}),"\n",(0,o.jsx)(n.p,{children:"Marlo needs a clean list of tools. This is metadata, not tool call logging."}),"\n",(0,o.jsx)(n.p,{children:"If you already have a tools list, build definitions from it:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'def _tool_schema(tool):\n    schema = {}\n    if hasattr(tool, "args_schema") and tool.args_schema is not None:\n        try:\n            schema = tool.args_schema.model_json_schema()\n        except Exception:\n            try:\n                schema = tool.args_schema.schema()\n            except Exception:\n                schema = {}\n    return {\n        "name": getattr(tool, "name", None),\n        "description": getattr(tool, "description", None),\n        "schema": schema,\n    }\n\nTOOL_DEFINITIONS = [_tool_schema(t) for t in tools]\n'})}),"\n",(0,o.jsx)(n.p,{children:"If you do not have tool objects, you can pass a manual list:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'TOOL_DEFINITIONS = [\n    {"name": "search_orders", "description": "lookup orders", "schema": {}},\n]\n'})}),"\n",(0,o.jsx)(n.h2,{id:"step-3-initialize-marlo",children:"Step 3: Initialize Marlo"}),"\n",(0,o.jsxs)(n.p,{children:["Call ",(0,o.jsx)(n.code,{children:"marlo.init(...)"})," once in the same process where the agent runs.\nThis registers your agent definition and starts learning refresh."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'import os\nimport marlo.learning as marlo\nfrom marlo.trajectories.capture.context import ExecutionContext\n\nMARLO_ORG_ID = os.getenv("MARLO_ORG_ID", "")\nMARLO_WRITE_KEY = os.getenv("MARLO_WRITE_KEY", "")\nMARLO_ENDPOINT = os.getenv("MARLO_ENDPOINT", "https://api.marshmallo.ai")\n\nif MARLO_ORG_ID and MARLO_WRITE_KEY:\n    ExecutionContext.get().metadata["org_id"] = MARLO_ORG_ID\n    marlo.init(\n        write_key=MARLO_WRITE_KEY,\n        agent_id="support-agent",\n        system_prompt=SYSTEM_PROMPT,\n        tool_definitions=TOOL_DEFINITIONS,\n        mcp_definitions=[],\n        model_config={"model": "gpt-4.1-mini"},\n        endpoint=MARLO_ENDPOINT,\n    )\n'})}),"\n",(0,o.jsx)(n.h2,{id:"step-4-wrap-the-agent-entrypoint",children:"Step 4: Wrap The Agent Entrypoint"}),"\n",(0,o.jsxs)(n.p,{children:["Use ",(0,o.jsx)(n.code,{children:"@marlo.wrap_agent"}),". This does ",(0,o.jsx)(n.strong,{children:"automatic task start/end"})," and emits agent start/end events."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'@marlo.wrap_agent(\n    name="support_agent",\n    system_prompt=SYSTEM_PROMPT,\n    tool_definitions=TOOL_DEFINITIONS,\n    mcp_definitions=[],\n    model_config={"model": "gpt-4.1-mini"},\n)\nasync def run_agent(state, config=None):\n    return await agent.ainvoke(state, config=config)\n'})}),"\n",(0,o.jsx)(n.h2,{id:"step-5-capture-tool-calls-required",children:"Step 5: Capture Tool Calls (Required)"}),"\n",(0,o.jsx)(n.p,{children:"Tool definitions are not tool usage. Tool usage must be captured at runtime."}),"\n",(0,o.jsx)(n.p,{children:"Add this inside each tool function:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'import marlo.learning as marlo\n\nasync def get_user_info_fn(config):\n    try:\n        result = await fetch_user_info(config)\n        marlo.track_tool(\n            tool_name="get_user_info",\n            input={"user_id": config.get("user_id")},\n            output=result,\n        )\n        return result\n    except Exception as exc:\n        marlo.track_tool(\n            tool_name="get_user_info",\n            input={"user_id": config.get("user_id")},\n            output=None,\n            error=str(exc),\n        )\n        raise\n'})}),"\n",(0,o.jsx)(n.h2,{id:"step-6-capture-llm-calls-required",children:"Step 6: Capture LLM Calls (Required)"}),"\n",(0,o.jsx)(n.p,{children:"Every model call must emit a LLM event with messages, response, usage, and reasoning."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'import marlo.learning as marlo\n\nresponse = await llm.ainvoke(messages)\n\nmarlo.track_llm(\n    messages=messages,\n    model="gpt-4.1-mini",\n    response=response,\n    usage=getattr(response, "usage", {}),\n    reasoning=getattr(response, "reasoning", {}),\n)\n'})}),"\n",(0,o.jsxs)(n.p,{children:["If your model does not return reasoning, pass ",(0,o.jsx)(n.code,{children:"{}"})," or leave it out. If it ",(0,o.jsx)(n.strong,{children:"does"})," return reasoning, you must include it."]}),"\n",(0,o.jsx)(n.h2,{id:"step-7-use-learnings-in-the-next-run",children:"Step 7: Use Learnings In The Next Run"}),"\n",(0,o.jsx)(n.p,{children:"Marlo can return learnings as plain text. You inject them into your system prompt."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'learnings_text = marlo.get_learnings_text()\n\nSYSTEM_PROMPT = f"""\nYou are a support agent.\n\nLearnings:\n{learnings_text}\n"""\n'})}),"\n",(0,o.jsxs)(n.p,{children:["You can refresh learnings on a timer or before each task. The hosted client refreshes automatically, and ",(0,o.jsx)(n.code,{children:"get_learnings_text()"})," reads the latest copy."]}),"\n",(0,o.jsx)(n.h2,{id:"agent-systems",children:"Agent Systems"}),"\n",(0,o.jsx)(n.p,{children:"Marlo supports multiple agentic system layouts. The wiring lives in your code, but the required fields are always the same: agent definitions, parent agent ids for child runs, and full task boundaries. The system structure pages explain the formats in detail:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Single agent: ",(0,o.jsx)(n.code,{children:"docs/agent-systems/single-agent"})]}),"\n",(0,o.jsxs)(n.li,{children:["Chain: ",(0,o.jsx)(n.code,{children:"docs/agent-systems/chain"})]}),"\n",(0,o.jsxs)(n.li,{children:["Orchestrator: ",(0,o.jsx)(n.code,{children:"docs/agent-systems/orchestrator"})]}),"\n",(0,o.jsxs)(n.li,{children:["Graph: ",(0,o.jsx)(n.code,{children:"docs/agent-systems/graph"})]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"full-example-single-agent-auth0-assistant",children:"Full Example: Single Agent (Auth0 Assistant)"}),"\n",(0,o.jsx)(n.p,{children:"This is a minimal, working example using the Auth0 assistant repo."}),"\n",(0,o.jsxs)(n.p,{children:["File: ",(0,o.jsx)(n.code,{children:"app/agents/assistant0.py"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'from langgraph.prebuilt import ToolNode, create_react_agent\nfrom langchain_openai import ChatOpenAI\nfrom datetime import date\nimport os\nimport marlo.learning as marlo\n\nfrom app.agents.tools.shop_online import shop_online\nfrom app.agents.tools.google_calendar import list_upcoming_events\nfrom app.agents.tools.user_info import get_user_info\nfrom app.agents.tools.context_docs import get_context_docs\n\ntools = [get_user_info, list_upcoming_events, shop_online, get_context_docs]\nllm = ChatOpenAI(model="gpt-4.1-mini")\n\ndef get_prompt():\n    today_str = date.today().strftime(\'%Y-%m-%d\')\n    learnings_text = marlo.get_learnings_text()\n    return (\n        f"You are a personal assistant named Assistant0. "\n        f"Learnings:\\n{learnings_text}\\n"\n        f"Use the tools as needed. Today is {today_str}."\n    )\n\ndef _tool_schema(tool):\n    schema = {}\n    if hasattr(tool, "args_schema") and tool.args_schema is not None:\n        try:\n            schema = tool.args_schema.model_json_schema()\n        except Exception:\n            try:\n                schema = tool.args_schema.schema()\n            except Exception:\n                schema = {}\n    return {\n        "name": getattr(tool, "name", None),\n        "description": getattr(tool, "description", None),\n        "schema": schema,\n    }\n\nTOOL_DEFINITIONS = [_tool_schema(t) for t in tools]\n\nMARLO_WRITE_KEY = os.getenv("MARLO_WRITE_KEY", "")\nMARLO_ENDPOINT = os.getenv("MARLO_ENDPOINT", "https://api.marshmallo.ai")\n\nif MARLO_WRITE_KEY:\n    marlo.init(\n        write_key=MARLO_WRITE_KEY,\n        agent_id="auth0-assistant0",\n        system_prompt=get_prompt(),\n        tool_definitions=TOOL_DEFINITIONS,\n        mcp_definitions=[],\n        model_config={"model": "gpt-4.1-mini"},\n        endpoint=MARLO_ENDPOINT,\n    )\n\nagent = create_react_agent(\n    llm,\n    tools=ToolNode(tools, handle_tool_errors=False),\n    prompt=get_prompt(),\n)\n\n@marlo.wrap_agent(\n    name="assistant0",\n    system_prompt=get_prompt(),\n    tool_definitions=TOOL_DEFINITIONS,\n    mcp_definitions=[],\n    model_config={"model": "gpt-4.1-mini"},\n)\nasync def run_agent(state, config=None):\n    return await agent.ainvoke(state, config=config)\n'})}),"\n",(0,o.jsxs)(n.p,{children:["Update ",(0,o.jsx)(n.code,{children:"langgraph.json"})," to point to ",(0,o.jsx)(n.code,{children:"run_agent"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "graphs": {\n    "agent": "./app/agents/assistant0.py:run_agent"\n  }\n}\n'})}),"\n",(0,o.jsx)(n.h2,{id:"multiagent-example",children:"Multi\u2011Agent Example"}),"\n",(0,o.jsxs)(n.p,{children:["When you have multiple agents, each one must be defined and wrapped.\nUse a stable ",(0,o.jsx)(n.code,{children:"agent_id"})," for each agent. If you know the parent/child relationship, set ",(0,o.jsx)(n.code,{children:"parent_agent_id"}),"."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'PARENT_ID = "support-root"\nCHILD_ID = "support-search"\n\n@marlo.wrap_agent(\n    name="support_root",\n    system_prompt=PARENT_PROMPT,\n    tool_definitions=PARENT_TOOLS,\n    mcp_definitions=[],\n    model_config={"model": "gpt-4.1-mini"},\n)\nasync def run_root(task: str):\n    result = await run_search(task)\n    return result\n\n@marlo.wrap_agent(\n    name="support_search",\n    system_prompt=SEARCH_PROMPT,\n    tool_definitions=SEARCH_TOOLS,\n    mcp_definitions=[],\n    model_config={"model": "gpt-4.1-mini"},\n    parent_agent_id=PARENT_ID,\n)\nasync def run_search(task: str):\n    return await search_agent.ainvoke({"input": task})\n'})}),"\n",(0,o.jsxs)(n.p,{children:["If you need a dynamic parent at runtime, wrap the sub\u2011agent call in ",(0,o.jsx)(n.code,{children:"trace_agent"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'with marlo.trace_agent(\n    name="support_search",\n    system_prompt=SEARCH_PROMPT,\n    tool_definitions=SEARCH_TOOLS,\n    mcp_definitions=[],\n    model_config={"model": "gpt-4.1-mini"},\n    parent_agent_id=marlo.get_current_agent_id(),\n):\n    result = await search_agent.ainvoke({"input": task})\n'})}),"\n",(0,o.jsx)(n.h2,{id:"checklist",children:"Checklist"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Organization ID is set before ",(0,o.jsx)(n.code,{children:"marlo.init(...)"})]}),"\n",(0,o.jsxs)(n.li,{children:["Agent entrypoint is wrapped with ",(0,o.jsx)(n.code,{children:"@marlo.wrap_agent"})]}),"\n",(0,o.jsxs)(n.li,{children:["All tool calls emit ",(0,o.jsx)(n.code,{children:"track_tool"})]}),"\n",(0,o.jsxs)(n.li,{children:["All LLM calls emit ",(0,o.jsx)(n.code,{children:"track_llm"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"marlo.init(...)"})," runs in the same process as the agent"]}),"\n",(0,o.jsx)(n.li,{children:"System prompt includes learnings"}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}}}]);